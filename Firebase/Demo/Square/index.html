<html>
<head></head>
<body>
<script src="https://www.gstatic.com/firebasejs/3.6.2/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.6.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.6.2/firebase-database.js"></script> 
<script src="../../fireHive.js" type="text/javascript"></script>
<canvas id="canv"></canvas>
<script>
	//hive init
	//To Do: i do not have a real way to know when hive is actually working and has all the data.
	
	window.onload =function(){
		hive.start(function(){
			var myColor=((1<<24)*Math.random()|0).toString(16);
			var pos = {x:50,y:50,color:"#"+myColor};
			var squares={};
			try
			{
				squares=hive.get("SquareDemoPosition");	
			}catch(err)
			{
				if(err=="Key not found in Hive Roots")
				squares = hive.set("SquareDemoPosition",{});
			}
			squares[myColor]=pos;
			pos=squares[myColor];
			//drawing init
			var canvas = document.getElementById("canv") 
			canvas.width=500;
			canvas.height=500;
			var ctx=canvas.getContext("2d");
			
			//drawing & refreshing
			function draw(){
				ctx.fillStyle = "black";
				ctx.fillRect(0,0,500,500);
				for(let k in squares)
				{
					let current = squares[k];
					ctx.fillStyle=current.color;
					ctx.fillRect(current.x-5,current.y-5,10,10);				
				}
			}
			setInterval(draw,10);
			//movement
			canvas.onmousemove = function(e){ var mouseX, mouseY;
				if(e.offsetX) {
					mouseX = e.offsetX;
					mouseY = e.offsetY;
				}
				else if(e.layerX) {
					mouseX = e.layerX;
					mouseY = e.layerY;
				} pos.x=mouseX; pos.y=mouseY;
			}
			window.onunload=function(){
				square[myColor]=null;
			}
		});
	}
	
</script>
</body></html>
