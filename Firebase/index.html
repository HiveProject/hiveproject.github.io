<html>
<head></head>
<body>
<script src="https://www.gstatic.com/firebasejs/3.6.2/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.6.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/3.6.2/firebase-database.js"></script>
<script>
  // Set the configuration for your app
  // TODO: Replace with your project's config object
  var config = {
    apiKey: " AIzaSyA-Y_mz58xgvGkQNK_tQCXQiG3q1mlA6hM",
    authDomain: "hive-1336.firebaseapp.com",
    databaseURL: "https://hive-1336.firebaseio.com/",
    storageBucket: "hive-1336.appspot.com"
  };
  firebase.initializeApp(config);

  // Get a reference to the database service
  var database = firebase.database();
  var loadedObjects= new Map();
  function Add(obj){
	if(loadedObjects.has(obj))
	{
		return loadedObjects.get(obj);
	}
	var key= database.ref("test").push().key; 
	loadedObjects.set(obj,key);
	var data = {};
	for (var k in obj) {
		if(obj[k]!=null){
			data[k] = {
				type:obj[k].constructor.name 
			};
			if(data[k].type=="Object"){
				data[k].value=	Add(obj[k]);
			}else if(data[k]!="Function"){
				data[k].value=obj[k];
			}else{
				
			}
		}
    }
	database.ref("test/"+key ).set(data);
	return key;	
}
function childAdded(dataSnapshot)
{
	if(!loadedObjects.has(dataSnapshot.key))
	{
		var obj = {};
		var received=dataSnapshot.val();
		for (var k in received) {
			if(received[k]!=null){
				if(received[k].type=="Object")
				{ 
					//if the object is not in my cache, i might have some sync issues here.
					obj[k]=loadedObjects.get(received[k].value);
				}else{
					//let's say this is a literal for now.
					obj[k]=received[k].value;
				}
			} 
		}
		loadedObjects.set(dataSnapshot.key,obj);
	}
}
function childRemoved(oldDataSnapshot)
{
	loadedObjects.delete(oldDataSnapshot.key);
}
function childChanged(dataSnapshot)
{
debugger;
}
database.ref("test").on("child_added",childAdded);
database.ref("test").on("child_removed",childRemoved);
database.ref("test").on("child_changed",childChanged);
</script>
</body></html>
