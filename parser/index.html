<html>
	<head>
		<link rel="stylesheet" type="text/css" 
			href="https://fonts.googleapis.com/css?family=Source Code Pro">
		<style>
			body {
				font-family: 'Source Code Pro', serif;
				font-size: 14px;
			}
						
            #repl_in {
				width: 100%;
            }
			
			#repl_out {
				white-space: pre-wrap;
			}
            
			.expr {
				font-weight: bold;
			}
		</style>
		<style>
        </style>		
		<script src="../realtime.Sugar.js"></script>
	</head>
	<body>
		<button id="auth_button">Authorize</button>
		<div id="controls">
			<p>
				<textarea id="repl_in" type="text" rows="5"
					onkeypress="if(event.which === 10 && event.ctrlKey) repl_eval();"></textarea>
			</p>
			<p>
				<input type="button" value="Eval" onclick="repl_eval();"></input>
			</p>
        </div>
        <p id="repl_out"></p>  
		
		<script src="parser.js"></script>
		<script src="compiler.js"></script>
		<script>
			function repl_eval(src) {
				if (src === undefined) {
					src = repl_in.value;
					repl_in.value = "";
				}
				repl_show(src, compiler.evaluate(src));
			}
		
            function repl_show(expr, result) {
                var p = document.createElement("p");
				split(expr).forEach(function (line, index) {				
					var exprDiv = document.createElement("div");
					exprDiv.setAttribute("class", "expr");
					exprDiv.textContent = (index == 0 ? ">>  " : "    ") + line;
					p.appendChild(exprDiv);
				});
				split(result).forEach(function (line) {				
					var resDiv = document.createElement("div");
					resDiv.setAttribute("class", "result");
					resDiv.textContent = line;
					p.appendChild(resDiv);
				});
                repl_out.insertBefore(p, repl_out.firstChild);
            }
			
			function split(str) {
				return str.match(/[^\r\n]+/g);
			}
		</script>
		<script>
	
	function setButton(){
	        var button = document.getElementById('auth_button');
            button.classList.add('visible');
            button.addEventListener('click', authorize);
	}
	function unSetButton(){
	
	        var button = document.getElementById('auth_button');
            button.classList.remove('visible');
            
	}
    function authorize() {
        // Attempt to authorize
        realtimeUtils.authorize(function(response){
          if(response.error){
            // Authorization failed because this is the first time the user has used your application,
            // show the authorize button to prompt them to authorize manually.
				setButton();
            }
           else {
              start(wireTextBoxes);
			  unSetButton();
          }
        },true);
	} 
	setButton();

      // Connects the text boxes to the collaborative string
      function wireTextBoxes(model) {
	  
		//var collaborativeString =model.getRoot().get('demo_string');
        //var textArea1 = document.getElementById('text_area_1'); 
        //gapi.drive.realtime.databinding.bindString(collaborativeString, textArea1); 
      }
    </script>
	</body>
</html>